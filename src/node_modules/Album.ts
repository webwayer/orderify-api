import { Model, DataTypes, Sequelize } from 'sequelize';

export async function AlbumFactory(sequelize: Sequelize, config: { SYNC_SEQUELIZE_MODELS: string }) {
    class Album extends Model {
        public readonly id!: number; // Note that the `null assertion` `!` is required in strict mode.
        public name!: string;

        // timestamps!
        public readonly createdAt!: Date;
        public readonly updatedAt!: Date;

        public facebookAlbumId: string;
        public facebookAlbumType: string;

        public coverPhotoId: string;
    }

    Album.init({
        id: {
            type: DataTypes.INTEGER.UNSIGNED,
            autoIncrement: true,
            primaryKey: true,
        },
        name: {
            type: new DataTypes.STRING(128),
            allowNull: false,
        },
        facebookAlbumId: {
            type: new DataTypes.STRING(128),
            allowNull: true,
        },
        facebookAlbumType: {
            type: new DataTypes.STRING(32),
            allowNull: true,
        },
        coverPhotoId: {
            type: new DataTypes.STRING(128),
            allowNull: true,
        }
    }, {
            tableName: 'Album',
            sequelize
        }
    );

    if (config.SYNC_SEQUELIZE_MODELS) {
        await Album.sync({ force: true })
    }

    return Album;
}

type Unpromise<T extends Promise<any>> = T extends Promise<infer U> ? U : never;
export type AlbumType = Unpromise<ReturnType<typeof AlbumFactory>>