import * as session from 'express-session'
import { Sequelize } from 'sequelize'

export async function sequelizeSessionStoreFactory(sequelize: Sequelize, config: { SYNC_SEQUELIZE_MODELS: string }) {
    const SequelizeStore = require('connect-session-sequelize')(session.Store)

    const store = new SequelizeStore({
        db: sequelize
    })

    if (config.SYNC_SEQUELIZE_MODELS) {
        await sequelize.sync()
    }

    return store
}