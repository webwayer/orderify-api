import * as request from 'request-promise'

export async function facebookGetAllPhotos(facebookUserId: string, facebookAccessToken: string) {
    const photos = JSON.parse(await request.get({
        qs: {
            limit: 1000,
            fields: 'album,name,alt_text,images'
        },
        uri: `https://graph.facebook.com/${facebookUserId}/photos?access_token=${facebookAccessToken}`
    })).data

    const albums = {};

    for (const photo of photos) {
        console.log(photo)
        if (!albums[photo.album.id]) {
            albums[photo.album.id] = {
                id: photo.album.id,
                name: photo.album.name,
                photos: []
            }
        }

        albums[photo.album.id].photos.push({
            id: photo.id,
            name: photo.name,
            alt_text: photo.alt_text,
            image: photo.images[photo.images.lenght - 1]
        })
    }

    return albums
}